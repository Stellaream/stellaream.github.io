<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>xv6 Lab Utilities | Stellaream's Blog</title><meta name="author" content="Stellaream"><meta name="copyright" content="Stellaream"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="This lab will familiarize you with xv6 and its system calls.">
<meta property="og:type" content="article">
<meta property="og:title" content="xv6 Lab Utilities">
<meta property="og:url" content="https://stellaream.github.io/xv6-Lab-Utilities/index.html">
<meta property="og:site_name" content="Stellaream&#39;s Blog">
<meta property="og:description" content="This lab will familiarize you with xv6 and its system calls.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://stellaream.github.io/img/cover.jpg">
<meta property="article:published_time" content="2025-03-13T09:52:49.000Z">
<meta property="article:modified_time" content="2025-03-15T14:37:45.305Z">
<meta property="article:author" content="Stellaream">
<meta property="article:tag" content="Stellaream">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://stellaream.github.io/img/cover.jpg"><link rel="shortcut icon" href="/img/logo.jpg"><link rel="canonical" href="https://stellaream.github.io/xv6-Lab-Utilities/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'xv6 Lab Utilities',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-image: url(/img/bg.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/logo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.jpg" alt="Logo"><span class="site-name">Stellaream's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">xv6 Lab Utilities</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">xv6 Lab Utilities</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-03-13T09:52:49.000Z" title="å‘è¡¨äº 2025-03-13 17:52:49">2025-03-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-03-15T14:37:45.305Z" title="æ›´æ–°äº 2025-03-15 22:37:45">2025-03-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/xv6/">xv6</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>å†™åœ¨å‰é¢ï¼šä½œä¸º mit åœ¨å›½é™…ä¸Šäº«èª‰ç››åçš„ OS å®éªŒï¼Œæ— æ•° CSer åŠ OS ç›¸å…³ä»ä¸šè€…éƒ½å°†å®Œæˆ xv6 å®éªŒä½œä¸ºå…¥å‘ OS çš„ç¬¬ä¸€æ­¥ã€‚ä¸å¾—ä¸è¯´ï¼Œxv6 ç¡®å®æœ‰ç€ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>xv6 åŸºäº RISC-V å¼€å‘ï¼Œä¸éœ€è¦è¢« x86 é—ç•™ä¸‹æ¥çš„å¤æ‚æœºåˆ¶æ‰€å›°æ‰°ï¼Œæä¾›äº†ä¸€ä¸ªæ¸…çˆ½çš„ã€ç¬¦åˆç›´è§‰çš„ã€ä¼˜é›…çš„å­¦ä¹ ç”Ÿæ€ â€”â€” ä¸ä¹‹å¯¹ç…§çš„æ˜¯æ³¥å·¥åŸºäº x86 æ¶æ„çš„ Linux 0.xx ç³»åˆ—å®éªŒï¼Œè™½ç„¶èµµç‚¯åšå£«çš„ linux å†…æ ¸å®Œå…¨æ³¨é‡ŠåŠ intel x86 çš„ç”¨æˆ·çº§æ‰‹å†Œæä¾›äº†å®Œå–„çš„èµ„æ–™ï¼Œç„¶è€ŒåŠ¨è¾„å‡ ç™¾é¡µçš„æ‰‹å†Œç¡®å®ä½¿æŸäº›äººæœ›è€Œç”Ÿç•ï¼Œè¿›è€Œæ”¾å¼ƒé˜…è¯»ï¼Œè¿™æ— æ¯”ä»¤äººé—æ†¾ã€‚</li>
<li>xv6 å®éªŒç¯å¢ƒçš„æ­å»ºéå¸¸ä¾¿æ· (è™½ç„¶å¿…é¡»æ‰¿è®¤ï¼Œç¯å¢ƒæ­å»ºè¿‡ç¨‹ä¸­è§£å†³é‡åˆ°çš„é—®é¢˜ç¡®å®æ˜¯ä¸å¾—ä¸è¿‡çš„ä¸€å…³)ï¼Œç„¶è€ŒèŠ±è´¹è¿‡å¤šæ—¶é—´é˜…è¯»ä¸Šå¤æ–‡æ¡£çš„ç¡®æ˜¯ a waste of time (é¬¼çŸ¥é“ bochs çš„æ–‡æ¡£è¯»äº†å¤šä¹…)ã€‚</li>
<li>xv6 çš„ä»£ç ç»“æ„ååˆ†ä¼˜é›…ï¼šåªéœ€å…³æ³¨ kernelã€mkfsã€user ä¸‰ä¸ªç›®å½•ã€‚è™½ç„¶ç»“æ„çš„ç®€åŒ–å¯¼è‡´äº†åŠŸèƒ½çš„ç®€åŒ–ï¼Œè¿™å¯¹äºåˆå­¦è€…æ˜¯ååˆ†å‹å¥½çš„ (linux 0.11 çš„ä»£ç ç›®å½•ç¡®å®è¿‡äºç¹æ‚)ï¼Œé€‚å½“çš„ç•™ç™½è¿˜å¯ä»¥ä½¿åˆå­¦è€…è‡ªç”±çš„å¡«å……å†…æ ¸ï¼Œè‚†æ„çš„å®ç° idea å¹¶æµ‹è¯•ã€‚</li>
<li>xv6 æä¾›äº†å®Œæ•´çš„å­¦ä¹ èµ„æ–™ â€”â€” mit 6.1810 çš„è¯¾ç¨‹å½•åƒã€ä¸º xv6 é‡èº«å®šåšçš„æ‰‹å†Œ (xv6 book) ä»¥åŠäº’è”ç½‘ä¸Šéšå¤„å¯è§çš„ blogï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½çš„è§£å†³å®éªŒè¿‡ç¨‹ä¸­çš„é—®é¢˜ã€‚ä¸€é—¨å¥½è¯¾æ‰€å¿…å¤‡çš„è¦ç´ ï¼Œä¸ä»…è¦æœ‰æ·±å…¥æµ…å‡ºçš„å†…å®¹è®²æˆï¼Œæ›´è¦æœ‰é…å¥—çš„ã€éš¾åº¦é€‚ä¸­çš„å®éªŒåŠå®Œå–„çš„èµ„æ–™åŠæ‰‹å†Œï¼Œè¿™æ˜¯å¤§éƒ¨åˆ†å›½å†…è¯¾ç¨‹æ‰€æ¬ ç¼ºçš„ã€‚<br>PSï¼šä¸ªäººè®¤ä¸ºé€šè¿‡ â€œå€Ÿé‰´â€ blog ä»¥è·å¾—çµæ„Ÿçš„è¡Œä¸ºæ˜¯ä¸æå€¡çš„ï¼Œå› ä¸ºè¿™ä¼šåœ¨æ— å½¢ä¸­ä½¿ä½ é”™è¿‡æ— æ•° treasure â€”â€” å®ç°è¿‡ç¨‹ä¸­çš„ç»†èŠ‚ã€å¤šæ ·çš„å®ç°æ€è·¯ã€ç¨‹åºçš„å¥å£®æ€§ä¸å®‰å…¨æ€§â€¦ï¼Œå¯¹è¿™äº›é—®é¢˜çš„æ€è€ƒä¼šäº§ç”Ÿæ½œç§»é»˜åŒ–çš„èƒ½åŠ›è¿›æ­¥ï¼Œå°½ç®¡å¯¹å®Œæˆå®éªŒæ²¡æœ‰ç›´æ¥çš„å¸®åŠ©ï¼Œè¿˜ä¼šèŠ±è´¹é¢å¤–çš„æ—¶é—´ã€‚æ›´æœ‰ç”šè€…ç›´æ¥é‡‡ç”¨ ctrl cv å¤§æ³•é€Ÿé€šäº† xv6 å®éªŒç”¨å…¶å¡«å……ç®€å†ï¼Œè¿™ä¸ä»…æ˜¯å¯¹è¿™é—¨è¯¾ç¨‹ï¼Œæ›´æ˜¯å¯¹ç¼–å†™ xv6 å¹¶å°†å…¶å¼€æºçš„å‡ ä½æ•™æˆçš„ä¸¥é‡ä¾®è¾±ã€‚</li>
</ul>
<p>å¦‚æ­¤ä¼˜ç§€å®éªŒçš„ç¼–å†™è‡ªç„¶è€—è´¹äº† Russ Coxã€Frans Kaashoek å’Œ Robert Morris ä¸‰ä½æ•™æˆå®è´µç²¾åŠ›ï¼Œå®éªŒå¼€æºä¹Ÿä¸ºä¸–ç•Œå„åœ°çš„ CSer æä¾›äº†å®è´µçš„å­¦ä¹ èµ„æºï¼Œè¯·å…è®¸æˆ‘çŒ®ä¸Šç”±è¡·çš„æ„Ÿè°¢åŠæ•¬æ„ã€‚</p>
<h1 id="Lab-Xv6-and-Unix-utilities"><a href="#Lab-Xv6-and-Unix-utilities" class="headerlink" title="Lab: Xv6 and Unix utilities"></a>Lab: Xv6 and Unix utilities</h1><p>æ­¤å®éªŒä¸»è¦ç›®çš„æ˜¯ç†Ÿæ‚‰ xv6 çš„æ¶æ„ã€ç³»ç»Ÿè°ƒç”¨åŠç›¸åº”ç”¨æˆ·ç¨‹åºçš„ç¼–å†™ã€‚å®éªŒæœ¬èº«ååˆ†ç®€å•ï¼Œç”¨æˆ·æ€ç¨‹åºçš„ç¼–å†™åªéœ€äº†è§£ç³»ç»Ÿè°ƒç”¨çš„æ ¼å¼ (API â€”â€” syscall) åŠå…¶ä½œç”¨ï¼Œåœ¨å®éªŒè¿‡ç¨‹ä¸­æ›´åº”æ³¨é‡æ€è€ƒå†…æ ¸å¦‚ä½•å®ç°ç›¸åº”ç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶åœ¨ xv6 æºç ä¸­éªŒè¯ã€‚(Tipsï¼šå·§å¦™ä½¿ç”¨ AI ç¡®å®å¯ä»¥æå¤§æé«˜æ•ˆç‡)</p>
<h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h2><p><em>Implement a user-level sleep program for xv6, along the lines of the UNIX sleep command. Your sleep should pause for a user-specified number of ticks. A tick is a notion of time defined by the xv6 kernel, namely the time between two interrupts from the timer chip. Your solution should be in the file user&#x2F;sleep.c.</em></p>
<p>user&#x2F;usys.S åŒ…å«ç³»ç»Ÿè°ƒç”¨ sleep çš„ç”¨æˆ·æ€æ±‡ç¼–ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sleep:</span><br><span class="line"> li a7, SYS_sleep</span><br><span class="line"> ecall</span><br><span class="line"> ret</span><br></pre></td></tr></table></figure>
<p>å¯¹äºç”¨æˆ·æ€ç¨‹åºï¼Œåªéœ€å°†å¯¹åº”ç³»ç»Ÿè°ƒç”¨ç¼–å· (SYS_sleep) å­˜å…¥ a7 å¯„å­˜å™¨ï¼Œéšåæ‰§è¡Œ ecall æŒ‡ä»¤å³å¯è¿›å…¥å†…æ ¸æ‰§è¡Œ sleep ç³»ç»Ÿè°ƒç”¨ã€‚ç«™åœ¨ç”¨æˆ·çš„è§†è§’ï¼Œç³»ç»Ÿè°ƒç”¨å®›å¦‚ä¸€ä¸ªé»‘åŒ£ï¼Œåªéœ€æŠŠå¯¹åº”å‚æ•°å­˜å…¥å¯¹åº”å†…å­˜æˆ–å¯„å­˜å™¨ï¼Œæ‰§è¡Œ ecall åä¾¿èƒ½å¾—åˆ°ä¸€ä¸ªæˆ‘ä»¬æœŸæœ›çš„çŠ¶æ€ã€‚jyy ï¼šâ€æ“ä½œç³»ç»Ÿä¸­æ²¡æœ‰ä»»ä½•é­”æ³•ã€‚â€ â€”â€” é‚£æˆ‘ä»¬ä¾¿ä¼šæœ‰ç–‘é—®ï¼Œ<strong>ecall åæ‰§è¡Œäº†ä»€ä¹ˆä»£ç ï¼Ÿecall åˆæ˜¯å¦‚ä½•å®šä½åˆ°å¯¹åº”ä»£ç ï¼Ÿ</strong> ç„¶è€Œé¢å¯¹åºå¤§çš„å†…æ ¸ä»£ç ï¼Œä¸€è¡Œè¡Œçš„æ£€ç´¢ä»£ç æ˜¾ç„¶æ˜¯ä¸ä¼˜é›…çš„ï¼Œæ›¾ç»æœ€ä¸ºæ™®éçš„è§£å†³æ–¹å¼å¤§æ¦‚æ˜¯é˜…è¯» xv6 book â€”â€” Chapter 4 Traps and system callsï¼Œç„¶è€Œå½“ä»Šæ›´ä¸ºæ¨èåˆ©ç”¨ AI å¸®åŠ©æˆ‘ä»¬æ£€ç´¢ä»£ç ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p>Qï¼šxv6 åœ¨æ‰§è¡Œ ecall æŒ‡ä»¤åå¦‚ä½•æ‰§è¡Œå†…æ ¸ä»£ç  (ä»¥ sleep ç³»ç»Ÿè°ƒç”¨ä¸ºä¾‹)ï¼Ÿ<br>A: åœ¨ xv6 ä¸­ï¼Œå½“ç”¨æˆ·è¿›ç¨‹æ‰§è¡Œ <code>ecall</code> æŒ‡ä»¤ï¼ˆRISC-V å¹³å°ï¼‰åï¼Œå¤„ç†å™¨ä¼šè§¦å‘ä¸€ä¸ª <strong>é™·å…¥ï¼ˆtrapï¼‰</strong>ï¼Œä»ç”¨æˆ·æ€ï¼ˆU-modeï¼‰åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼ˆS-modeï¼‰ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„å†…æ ¸ä»£ç ã€‚ä»¥ä¸‹æ˜¯ <code>sleep</code> ç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œæµç¨‹ï¼š<br>  123balabalaâ€¦<br><strong>æ€»ç»“</strong><br>æ•´ä¸ª <code>sleep</code> ç³»ç»Ÿè°ƒç”¨æµç¨‹ï¼š</p>
<ol>
<li>ç”¨æˆ·è¿›ç¨‹æ‰§è¡Œ <code>sleep(n)</code>ï¼Œè§¦å‘ <code>ecall</code>ã€‚</li>
<li><code>usertrap()</code> å¤„ç† <code>ecall</code>ï¼Œè°ƒç”¨ <code>syscall()</code>ã€‚</li>
<li><code>syscall()</code> è°ƒç”¨ <code>sys_sleep()</code>ï¼Œè¿›å…¥ <code>sleep()</code>ã€‚</li>
<li><code>sleep()</code> ä½¿è¿›ç¨‹ç¡çœ ï¼Œè°ƒç”¨ <code>sched()</code> è¿›è¡Œè°ƒåº¦ã€‚</li>
<li>æ—¶é’Ÿä¸­æ–­ <code>clockintr()</code> å¢åŠ  <code>ticks</code>ï¼Œè°ƒç”¨ <code>wakeup()</code> å”¤é†’è¿›ç¨‹ã€‚</li>
<li><code>scheduler()</code> é‡æ–°è°ƒåº¦ <code>sleep</code> è¿›ç¨‹ï¼Œæ¢å¤æ‰§è¡Œã€‚</li>
</ol>
<p>è¿™ä¸ªæµç¨‹å±•ç¤ºäº† <code>xv6</code> å¦‚ä½•åˆ©ç”¨ <strong>ç³»ç»Ÿè°ƒç”¨ã€è¿›ç¨‹è°ƒåº¦ã€æ—¶é’Ÿä¸­æ–­</strong> æ¥å®ç° <code>sleep</code>ã€‚</p>
</li>
</ul>
<p>å¦‚æœå¯¹äºæŸäº›ç»†èŠ‚å®ç°ä»ç„¶å­˜åœ¨é—®é¢˜ï¼Œå¯ä»¥ç»§ç»­æ·±å…¥ï¼š</p>
<ul>
<li>Qï¼šecall åè·³åˆ° usertrap æ˜¯ä½•æ—¶è®¾ç½®çš„ï¼Ÿ<br>Aï¼šecall æŒ‡ä»¤æ‰§è¡Œåä¼šè¿›å…¥ usertrap()ï¼Œè¿™æ˜¯ç”± å¼‚å¸¸å‘é‡è¡¨ï¼ˆtrap vectorï¼‰ é¢„å…ˆè®¾ç½®çš„ï¼Œä¸»è¦ç”± stvecï¼ˆé™·é˜±å‘é‡åŸºå€å¯„å­˜å™¨ï¼‰æ§åˆ¶ã€‚å…·ä½“æ¥è¯´ï¼Œusertrap() åœ¨ ecall è§¦å‘åè¢«è°ƒç”¨çš„æ—¶æœºï¼Œå–å†³äº stvec åœ¨è¿›ç¨‹åˆ‡æ¢åˆ°ç”¨æˆ·æ€ä¹‹å‰çš„è®¾ç½®ã€‚<br>  123balabalaâ€¦<br><strong>æ€»ç»“</strong><ul>
<li><code>ecall</code> è§¦å‘åï¼ŒCPU è·³è½¬åˆ° <code>stvec</code> æŒ‡å®šçš„ <code>uservec</code>ã€‚</li>
<li><code>uservec</code> æ˜¯ä¸ªæ±‡ç¼–å…¥å£ï¼Œå®ƒåˆ‡æ¢å†…æ ¸æ ˆå¹¶è°ƒç”¨ <code>usertrap()</code>ã€‚</li>
<li><code>stvec</code> æ˜¯åœ¨ <strong>ç”¨æˆ·è¿›ç¨‹åˆ‡æ¢å‰ï¼ˆ<code>usertrapret()</code>ï¼‰</strong> è®¾ç½®ä¸º <code>uservec</code>ï¼Œç¡®ä¿ <code>ecall</code> å‘ç”Ÿæ—¶è¿›å…¥ <code>usertrap()</code> å¤„ç†ç³»ç»Ÿè°ƒç”¨ã€‚</li>
</ul>
</li>
</ul>
<p>åˆ©ç”¨ AI åºå¤§çš„ä¿¡æ¯æ£€ç´¢å’Œå¤„ç†èƒ½åŠ›å¯ä»¥æå¤§çš„é™ä½æˆ‘ä»¬çš„å­¦ä¹ é—¨æ§›ï¼Œå­¦ä¼šæé—®å› è€Œæ˜¾å¾—è‡³å…³é‡è¦ï¼Œè¿™ä¸ä»…æ„å‘³ç€è¦äº†è§£å†…æ ¸å¯¹äºå®ç°æ–¹æ³•ï¼Œæ›´è¦æ€è€ƒå…¶å¦‚æ­¤å®ç°çš„åŸå› ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p>Qï¼šä¸ºä»€ä¹ˆè¦åœ¨æ¯ä¸ªè¿›ç¨‹è¿è¡Œå‰å°† stvec è®¾ç½®åˆ° usertrap è€Œä¸æ˜¯ç»Ÿä¸€è®¾ç½®ï¼Ÿ<br>Aï¼šbalabalaâ€¦<br><strong>æ€»ç»“</strong><br>åœ¨ xv6 ä¸­ï¼Œ<code>stvec</code> ä¸èƒ½å…¨å±€ç»Ÿä¸€è®¾ç½®ï¼Œè€Œå¿…é¡» <strong>åœ¨æ¯ä¸ªè¿›ç¨‹è¿è¡Œå‰åŠ¨æ€è°ƒæ•´</strong>ï¼ŒåŸå› åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>åŒºåˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€é™·å…¥</strong>ï¼šè¿›ç¨‹è¿›å…¥å†…æ ¸æ€å <code>stvec</code> éœ€è¦æ”¹ä¸º <code>kernelvec</code>ï¼Œå¦åˆ™å†…æ ¸æ€å¼‚å¸¸ä¼šé”™è¯¯è·³è½¬åˆ° <code>usertrap()</code>ã€‚</li>
<li><strong>æ¯ä¸ªè¿›ç¨‹çš„ <code>uservec</code> å¯èƒ½ä¸åŒ</strong>ï¼š<code>uservec</code> åœ¨ <code>trampoline</code> åŒºåŸŸï¼Œä¸åŒè¿›ç¨‹å¯èƒ½æœ‰ä¸åŒçš„æ˜ å°„ã€‚</li>
<li><strong>ä¿è¯è¿›ç¨‹ç‹¬ç«‹æ€§</strong>ï¼šæœªæ¥å¦‚æœæ”¯æŒä¸åŒè¿›ç¨‹çš„ <code>trap</code> å¤„ç†æ–¹å¼ï¼ŒåŠ¨æ€è°ƒæ•´ <code>stvec</code> è®©å®ƒä»¬å¯ä»¥ç‹¬ç«‹è®¾ç½®ã€‚</li>
<li><strong>é€‚é…è¿›ç¨‹åˆ‡æ¢</strong>ï¼šä¸åŒè¿›ç¨‹è¿è¡Œå‰éœ€è¦ä¸åŒçš„ <code>stvec</code>ï¼Œå¦åˆ™é™·å…¥æ—¶å¯èƒ½è¿›å…¥é”™è¯¯çš„å¼‚å¸¸å¤„ç†ä»£ç ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œåœ¨ xv6 çš„è®¾è®¡ä¸­ï¼Œæ¯æ¬¡ç”¨æˆ·è¿›ç¨‹è¦è¿è¡Œå‰ï¼Œéƒ½ä¼šåœ¨ <code>usertrapret()</code> é‡Œ <strong>åŠ¨æ€è®¾ç½® <code>stvec</code></strong>ï¼Œç¡®ä¿ <code>ecall</code> æˆ–å…¶ä»–ç”¨æˆ·æ€å¼‚å¸¸èƒ½å¤Ÿæ­£ç¡®è¿›å…¥ <code>usertrap()</code>ã€‚</p>
</li>
</ul>
<p>åœ¨å†…æ ¸ä»£ç å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œ<strong>å¦‚ä½•åšï¼Ÿä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ</strong> å§‹ç»ˆæ˜¯è´¯å½»å§‹ç»ˆçš„ä¸»çº¿ä»»åŠ¡ï¼Œ<del>ä½ å°†æ‰®æ¼”ä¸€ä½åä¸ºã€Œå“ˆå…µã€çš„ç¥ç§˜è§’è‰²â€¦</del> ä¿æŒå¯¹ä¸€åˆ‡äº‹ç‰©çš„å¥½å¥‡å’Œæ€€ç–‘ï¼Œä½ å°†ä¸€æ­¥æ­¥æ­å¼€ xv6 çš„ç¥ç§˜é¢çº±ã€‚</p>
<h2 id="pingpong"><a href="#pingpong" class="headerlink" title="pingpong"></a>pingpong</h2><p><em>Write a user-level program that uses xv6 system calls to â€˜â€™ping-pongâ€™â€™ a byte between two processes over a pair of pipes, one for each direction. The parent should send a byte to the child; the child should print â€œ&lt;pid&gt;: received pingâ€, where &lt;pid&gt; is its process ID, write the byte on the pipe to the parent, and exit; the parent should read the byte from the child, print â€œ&lt;pid&gt;: received pongâ€, and exit. Your solution should be in the file user&#x2F;pingpong.c.</em></p>
<p>pipe ä¸ºä¸åŒè¿›ç¨‹é—´é€šä¿¡æä¾›äº†çµæ´»çš„æ¥å£ï¼Œè¿™ä¸ä»…æŒ‡ç®¡é“æ„å»ºæ—¶çš„ä»»æ„æ€§ï¼Œè¿˜æ¶‰åŠåˆ°ä¼ è¾“è¿‡ç¨‹ä¸­éšå«çš„é€šä¿¡è§„åˆ™ã€‚åŒæ ·çš„ï¼Œpipe çš„å®ç°ä¸å¯é¿å…çš„ä¼šæ¶‰åŠåˆ°æ–‡ä»¶ç³»ç»Ÿã€è¯»å†™çš„å¹¶å‘æ€§ç­‰å¤æ‚é—®é¢˜ï¼Œæ•…ç›®å‰å¹¶ä¸æ‰“ç®—æ·±å…¥é˜…è¯»å…¶å®ç°æºç ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šæ”¾åœ¨å®éªŒæœ«æœŸã€‚</p>
<h2 id="primes"><a href="#primes" class="headerlink" title="primes"></a>primes</h2><p><em>Write a concurrent prime sieve program for xv6 using pipes and the design illustrated in the picture halfway down this page and the surrounding text. This idea is due to Doug McIlroy, inventor of Unix pipes. Your solution should be in the file user&#x2F;primes.c.</em></p>
<p>å¾ˆæœ‰æ„æ€çš„éƒ¨åˆ†ï¼Œå‚è€ƒæ–‡ç« ä¸­æåˆ°çš„ Bell Lab è®©äººæœ‰æç„¶éš”ä¸–ä¹‹æ„Ÿï¼Œåœ¨æ–‡ç« ä¸­ä½ å¯ä»¥çœ‹åˆ°åœ¨é‚£ä¸ªç¡¬ä»¶å—åˆ°é™åˆ¶çš„å¹´ä»£ï¼Œå¤æ—©æ—¶æœŸçš„ç å†œä»¬ä¸ºè§£å†³é—®é¢˜å¤©é©¬è¡Œç©ºåˆæ— æ¯”ä¼˜é›…çš„æ€è·¯ã€‚æ ¹æ®å®éªŒè¦æ±‚ï¼Œå¿…é¡»ä½¿åˆå§‹è¿›ç¨‹æœ€åé€€å‡ºï¼Œè¿™ä¹Ÿå°±è§„èŒƒäº†é€’å½’çš„æ–¹å‘ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„å®ç° (æ„Ÿè§‰ç é£ <del>çƒ‚çš„åƒå±</del> è¿˜æœ‰å¾ˆå¤§è¿›æ­¥ç©ºé—´)ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">void sieve(int p_read)&#123;</span><br><span class="line">    int prime;</span><br><span class="line">    if(read(p_read, &amp;prime, sizeof(prime)) == 0)&#123;</span><br><span class="line">        exit(0);</span><br><span class="line">    &#125;</span><br><span class="line">    fprintf(1, &quot;prime %d\n&quot;, prime);</span><br><span class="line">    </span><br><span class="line">    int temp;</span><br><span class="line">    int p[2];</span><br><span class="line">    pipe(p);</span><br><span class="line"></span><br><span class="line">    if(fork() == 0)&#123;</span><br><span class="line">        // child</span><br><span class="line">        close(p_read);</span><br><span class="line">        close(p[1]);</span><br><span class="line">        sieve(p[0]);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // parent</span><br><span class="line">        close(p[0]);</span><br><span class="line">        while(read(p_read, &amp;temp, sizeof(temp)) != 0)&#123;</span><br><span class="line">            if(temp % prime != 0)&#123;</span><br><span class="line">                write(p[1], &amp;temp, sizeof(temp));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        close(p[1]);</span><br><span class="line">        wait(0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    exit(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    if(argc != 1)&#123;</span><br><span class="line">        fprintf(2, &quot;Usage: primes\n&quot;);</span><br><span class="line">        exit(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int p[2];</span><br><span class="line">    pipe(p);</span><br><span class="line"></span><br><span class="line">    if(fork() == 0)&#123;</span><br><span class="line">        // child</span><br><span class="line">        close(p[1]);</span><br><span class="line">        sieve(p[0]);</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // parent</span><br><span class="line">        close(p[0]);</span><br><span class="line">        for(int i = 2; i &lt;= 35; i++)&#123;</span><br><span class="line">            write(p[1], &amp;i, sizeof(i));</span><br><span class="line">        &#125;</span><br><span class="line">        close(p[1]);</span><br><span class="line">        wait(0);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p><em>Write a simple version of the UNIX find program for xv6: find all the files in a directory tree with a specific name. Your solution should be in the file user&#x2F;find.c.</em></p>
<p>æœ‰ç‚¹éº»çƒ¦çš„ç”¨æˆ·ç¨‹åºï¼Œå› ä¸ºå…¶æ¶‰åŠåˆ°äº†æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ•°æ®ç»“æ„ï¼Œä½† ls çš„å®ç°å¯ä»¥æä¾›å¾ˆå¤§ç¨‹åº¦çš„å‚è€ƒ (æ³¨æ„æ˜¯å‚è€ƒï¼Œç›´æ¥ä¸ç»å¤§è„‘å·è¿‡æ¥ä¼šæ¯”è¾ƒéº»çƒ¦)ã€‚å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">char*</span><br><span class="line">fmtname(char *path)</span><br><span class="line">&#123;</span><br><span class="line">  static char buf[DIRSIZ+1];</span><br><span class="line">  char *p;</span><br><span class="line"></span><br><span class="line">  // Find first character after last slash.</span><br><span class="line">  for(p=path+strlen(path); p &gt;= path &amp;&amp; *p != &#x27;/&#x27;; p--)</span><br><span class="line">    ;</span><br><span class="line">  p++;</span><br><span class="line"></span><br><span class="line">  // Return blank-padded name.</span><br><span class="line">  if(strlen(p) &gt;= DIRSIZ)</span><br><span class="line">    return p;</span><br><span class="line">  memmove(buf, p, strlen(p));</span><br><span class="line">  memset(buf+strlen(p), 0, DIRSIZ-strlen(p));</span><br><span class="line">  return buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void find(char *path, char *filename)</span><br><span class="line">&#123;</span><br><span class="line">    char buf[512], *p;</span><br><span class="line">    int fd;</span><br><span class="line">    struct dirent de;</span><br><span class="line">    struct stat st;</span><br><span class="line"></span><br><span class="line">    if((fd = open(path, O_RDONLY)) &lt; 0)&#123;</span><br><span class="line">        fprintf(2, &quot;find: cannot open %s\n&quot;, path);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(fstat(fd, &amp;st) &lt; 0)&#123;</span><br><span class="line">        fprintf(2, &quot;find: cannot stat %s\n&quot;, path);</span><br><span class="line">        close(fd);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    switch(st.type)&#123;</span><br><span class="line">    case T_DEVICE:</span><br><span class="line">    case T_FILE:</span><br><span class="line">        if(strcmp(fmtname(path), filename) == 0)&#123;</span><br><span class="line">            printf(&quot;%s\n&quot;, path);</span><br><span class="line">        &#125;</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">    case T_DIR:</span><br><span class="line">        if(strlen(path) + 1 + DIRSIZ + 1 &gt; sizeof buf)&#123;</span><br><span class="line">            printf(&quot;find: path too long\n&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        strcpy(buf, path);</span><br><span class="line">        p = buf+strlen(buf);</span><br><span class="line">        *p++ = &#x27;/&#x27;;</span><br><span class="line">        while(read(fd, &amp;de, sizeof(de)) == sizeof(de))&#123;</span><br><span class="line">            if(de.inum == 0 || strcmp(de.name, &quot;.&quot;) == 0 || strcmp(de.name, &quot;..&quot;) == 0)</span><br><span class="line">                continue;</span><br><span class="line">            memmove(p, de.name, DIRSIZ);</span><br><span class="line">            p[DIRSIZ] = 0;</span><br><span class="line"></span><br><span class="line">            find(buf, filename);</span><br><span class="line">        &#125;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    close(fd);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    if(argc != 3)&#123;</span><br><span class="line">        fprintf(2, &quot;Usage: find path filename\n&quot;);</span><br><span class="line">        exit(1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    find(argv[1], argv[2]);</span><br><span class="line">    exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥éƒ¨åˆ†å®ç°èŠ±è´¹äº†æˆ‘å°†è¿‘åŠä¸ªå°æ—¶ debugï¼Œä¸»è¦è¸©äº†ä¸¤ä¸ªå‘ï¼š</p>
<ul>
<li>ç›´æ¥å·æ¥çš„ fmtname å‡½æ•°é‡‡ç”¨ â€˜ â€˜ (ç©ºæ ¼) å¡«å……ï¼Œå¯¼è‡´ strcmp å‡½æ•°è¿”å›é”™è¯¯ï¼Œç¨‹åºæ²¡æœ‰è¾“å‡ºã€‚</li>
<li>åœ¨å‘ç°è¯¥é—®é¢˜åï¼Œé¼ é¼ éå¸¸çˆ½å¿«çš„ç”¨äº† strcmp(fmtname(A), fmtname(B)) &#x3D;&#x3D; 0 ä½œä¸ºåˆ¤æ–­æ¡ä»¶ï¼Œç»“æœå°±æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½è¢«è¾“å‡ºäº†ã€‚æœ€åå‘ç°æ˜¯å› ä¸º fmtname å‡½æ•°å°†è¿”å›å­—ç¬¦ä¸²å­˜å‚¨åœ¨å‡½æ•°å†…é™æ€å®šä¹‰çš„ buf ä¸­ï¼Œstrcmp å‡½æ•°æ¯”è¾ƒçš„åœ°å€ç©ºé—´æŒ‡å‘åŒä¸€åœ°å€ï¼Œå¹¶ä¸”å…¶é¦–æ¬¡ä¿å­˜çš„åç§°è¢«è¦†ç›–æ‰äº†ï¼Œè¿™ç§ä½çº§é”™è¯¯ä»¤äººå¿ä¿Šä¸ç¦ <del>é»˜å†™ static ä¸‰éâœ‹ğŸ˜­ğŸ¤š</del></li>
</ul>
<p>æ‰€ä»¥è¯´å·ä»£ç ä¹‹å‰ä¸€å®šè¦è¯»æ˜ç™½å•Šï¼ï¼ï¼</p>
<h2 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h2><p><em>Write a simple version of the UNIX xargs program for xv6: its arguments describe a command to run, it reads lines from the standard input, and it runs the command for each line, appending the line to the commandâ€™s arguments. Your solution should be in the file user&#x2F;xargs.c.</em></p>
<p>çœŸå®çš„ xargs on Unix æ›´ä¸ºçµæ´»ï¼Œå®ç°è‡ªç„¶æ›´ä¸ºå¤æ‚ï¼Œè¿˜å¥½æˆ‘ä»¬åªç”¨å®ç°æç®€ç‰ˆã€‚å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char *argv[]) &#123;</span><br><span class="line">    if(argc &lt; 2) &#123;</span><br><span class="line">        fprintf(2, &quot;usage: xargs command\n&quot;);</span><br><span class="line">        exit(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    char *argvs[MAXARG];</span><br><span class="line">    for(int i = 1; i &lt; argc; i++) &#123;</span><br><span class="line">        argvs[i - 1] = argv[i];</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    char buf[512];</span><br><span class="line">    char *p = buf;</span><br><span class="line">    while(read(0, p, sizeof(char)) &gt; 0)&#123;</span><br><span class="line">        if(*p != &#x27;\n&#x27;)&#123;</span><br><span class="line">            p++;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            *p = &#x27;\0&#x27;;</span><br><span class="line">            p = buf;</span><br><span class="line">            argvs[argc - 1] = buf;</span><br><span class="line">            if(fork() == 0)&#123;</span><br><span class="line">                // child</span><br><span class="line">                exec(argvs[0], argvs);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                // father</span><br><span class="line">                wait(0);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šä¾‹å®ç°ä»£ç è™½ç„¶å¯ä»¥é¡ºåˆ©é€šè¿‡æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨å†…å­˜å®‰å…¨æ–¹é¢çš„è€ƒè™‘ä»æœ‰æ‰€æ¬ ç¼ºã€‚ä¸åŒäºç”¨æˆ·æ€ç¨‹åºåœ¨è¿›ç¨‹ç»“æŸåé‡Šæ”¾æ‰å†…å­˜ç©ºé—´ï¼Œå†…æ ¸ä¸­å¤„ç†å­—ç¬¦ä¸²æ—¶è¦ç‰¹åˆ«æ³¨æ„æŒ‡é’ˆå¸¦æ¥çš„å†…å­˜é—®é¢˜ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://stellaream.github.io">Stellaream</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://stellaream.github.io/xv6-Lab-Utilities/">https://stellaream.github.io/xv6-Lab-Utilities/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://stellaream.github.io" target="_blank">Stellaream's Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/xv6-Lab-System-calls/" title="xv6 Lab System calls"><img class="cover" src="/img/cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">xv6 Lab System calls</div></div><div class="info-2"><div class="info-item-1">In the last lab you used system calls to write a few utilities. In this lab you will add some new system calls to xv6, which will help you understand how they work and will expose you to some of the internals of the xv6 kernel. You will add more system calls in later labs.</div></div></div></a><a class="pagination-related" href="/HIT-OS-LAB6/" title="HIT-OS LAB6 ä¿¡å·é‡çš„å®ç°å’Œåº”ç”¨"><img class="cover" src="/img/cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">HIT-OS LAB6 ä¿¡å·é‡çš„å®ç°å’Œåº”ç”¨</div></div><div class="info-2"><div class="info-item-1">Lab6 -- ä¿¡å·é‡çš„å®ç°å’Œåº”ç”¨</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/logo.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Stellaream</div><div class="author-info-description">å¿ƒæ€€æ¢¦æƒ³ ä¸è´Ÿæ˜Ÿå…‰</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">2</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Lab-Xv6-and-Unix-utilities"><span class="toc-number">1.</span> <span class="toc-text">Lab: Xv6 and Unix utilities</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sleep"><span class="toc-number">1.1.</span> <span class="toc-text">sleep</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pingpong"><span class="toc-number">1.2.</span> <span class="toc-text">pingpong</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#primes"><span class="toc-number">1.3.</span> <span class="toc-text">primes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#find"><span class="toc-number">1.4.</span> <span class="toc-text">find</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xargs"><span class="toc-number">1.5.</span> <span class="toc-text">xargs</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/xv6-Lab-Traps/" title="xv6 Lab Traps">xv6 Lab Traps</a><time datetime="2025-07-17T04:15:03.000Z" title="å‘è¡¨äº 2025-07-17 12:15:03">2025-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/xv6-Lab-Page-tables/" title="xv6 Lab Page tables">xv6 Lab Page tables</a><time datetime="2025-04-28T05:30:13.000Z" title="å‘è¡¨äº 2025-04-28 13:30:13">2025-04-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/xv6-Lab-System-calls/" title="xv6 Lab System calls">xv6 Lab System calls</a><time datetime="2025-03-15T07:20:50.000Z" title="å‘è¡¨äº 2025-03-15 15:20:50">2025-03-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/xv6-Lab-Utilities/" title="xv6 Lab Utilities">xv6 Lab Utilities</a><time datetime="2025-03-13T09:52:49.000Z" title="å‘è¡¨äº 2025-03-13 17:52:49">2025-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/HIT-OS-LAB6/" title="HIT-OS LAB6 ä¿¡å·é‡çš„å®ç°å’Œåº”ç”¨">HIT-OS LAB6 ä¿¡å·é‡çš„å®ç°å’Œåº”ç”¨</a><time datetime="2025-01-09T00:30:59.000Z" title="å‘è¡¨äº 2025-01-09 08:30:59">2025-01-09</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2025 By Stellaream</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>